<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>ÖĞRENCİ TAKİP PROGRAMI</title>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<style>
    :root{
      --bg:#0f172a; --panel:#1e293b; --muted:#334155; --text:#e2e8f0;
      --accent1:#3b82f6; --accent2:#06b6d4; --warn:#f97316; --ok:#10b981; --danger:#ef4444;
      --export-bg:#0b1427; --export-head:#93c5fd;
      --card:#0b1427; --cardBorder:#263247;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Arial,Helvetica,sans-serif}
    .header{padding:22px;text-align:center;}
    .main-title{font-size:22px;font-weight:800;color:#93c5fd;text-transform:uppercase}
    .subtitle{font-size:16px;font-weight:500;color:#a5b4fc;margin-top:4px}
    .subheader{font-size:16px;color:#cbd5e1;margin-top:4px;font-weight:600;}

    .tabs{display:flex;gap:8px;justify-content:center;max-width:1080px;margin:0 auto 12px;padding:8px;background:var(--panel);border-radius:12px;flex-wrap:wrap}
    .tabs button{flex:1;min-width:160px;padding:12px;border:0;border-radius:10px;background:transparent;color:#cbd5e1;font-weight:700;cursor:pointer}
    .tabs button.active{background:var(--ok);color:#fff}

    /* Odak halkalarını yeşil yap */
    .tabs button:focus,
    .pill:focus,
    .classPick:focus,
    .dayBtn:focus,
    .weekBtn:focus,
    .studentNameBtn:focus,
    .delStuBtn:focus,
    .delStuFloat:focus,
    .delFloat:focus,
    button.action:focus{
      outline:3px solid rgba(16,185,129,.55);
      outline-offset:2px;
    }

    .container{max-width:1080px;margin:16px auto;background:var(--panel);border-radius:16px;padding:22px}
    h3{margin:0 0 14px}
    input,select{width:100%;padding:12px;border:0;border-radius:10px;background:var(--bg);color:#e2e8f0;margin:8px 0}
    button.action{width:100%;padding:12px;border:0;border-radius:12px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;font-weight:800;cursor:pointer;min-height:48px}
    button.logout{background:var(--warn)}
    table{width:100%;border-collapse:collapse;margin:10px 0}
    th,td{border:1px solid var(--muted);padding:10px;text-align:center}
    .row{display:flex;gap:10px;align-items:center}
    .row>.grow{flex:1}

    /* ---- Sınıf kartları ---- */
    .classGrid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap:14px;
      margin-top:12px;
    }
    .classCard{
      position:relative;
      background:var(--card);
      border:1px solid var(--cardBorder);
      border-radius:14px;
      padding:14px 14px 48px;
      transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .classCard:hover{ transform:translateY(-2px); box-shadow:0 8px 18px rgba(0,0,0,.25); border-color:#3b4b6a; }
    .className{ font-weight:900; font-size:20px; letter-spacing:.3px; margin-bottom:8px; }
    .classPick{
      position:absolute; left:14px; right:14px; bottom:14px;
      border:0; border-radius:10px; padding:10px 12px; cursor:pointer;
      color:#fff; font-weight:800;
      background:linear-gradient(90deg,var(--accent1),var(--accent2));
    }
    .classPick.active{ outline:3px solid rgba(16,185,129,.40) }

    /* --- Sınıf silme ikonu (zemin üstünde, hover'da flu kırmızı) --- */
    .delFloat{
      position:absolute; top:10px; right:10px;
      display:grid; place-items:center;
      width:36px; height:36px; padding:0;
      border:0; border-radius:999px;
      background:transparent;
      cursor:pointer;
      transition:transform .12s ease, opacity .12s ease;
      z-index:2;
    }
    .delFloat img.trashIcon{ width:20px; height:20px; display:block; }
    .delFloat:hover{ transform:translateY(-1px); }
    .delFloat::before{
      content:""; position:absolute; inset:0; border-radius:999px;
      background:rgba(239,68,68,.26);
      filter:blur(8px);
      opacity:0; transition:opacity .12s ease;
      z-index:-1;
    }
    .delFloat:hover::before{ opacity:1; }

    /* --- Öğrenci silme: tuş yerine zeminde çöp kovası simgesi --- */
    .studentItem{display:flex;align-items:center;gap:8px;justify-content:space-between;padding:10px;background:#0b1427;margin:6px 0;border-radius:10px; position:relative;}
    .studentItem.hasDel{ padding-right:48px; } /* sağ üstteki ikon için yer aç */
    .delStuFloat{
      position:absolute; top:8px; right:8px;
      display:grid; place-items:center;
      width:36px; height:36px; padding:0;
      border:0; border-radius:999px;
      background:transparent;
      cursor:pointer;
      transition:transform .12s ease, opacity .12s ease;
      z-index:2;
    }
    .delStuFloat img.trashIcon{ width:18px; height:18px; display:block; }
    .delStuFloat:hover{ transform:translateY(-1px); }
    .delStuFloat::before{
      content:""; position:absolute; inset:0; border-radius:999px;
      background:rgba(239,68,68,.26);
      filter:blur(8px);
      opacity:0; transition:opacity .12s ease;
      z-index:-1;
    }
    .delStuFloat:hover::before{ opacity:1; }

    /* (Eski) Öğrenci silme butonu – geriye dönük stil, artık kullanılmıyor */
    .delStuBtn{
      background:linear-gradient(180deg,#ef4444,#dc2626);
      border:1px solid #7f1d1d;
      color:#fff; font-weight:800;
      border-radius:10px;
      padding:8px 12px;
      cursor:pointer;
      display:flex; align-items:center; gap:6px;
      box-shadow:0 6px 16px rgba(239,68,68,.25), inset 0 1px 0 rgba(255,255,255,.08);
      transition:transform .12s ease, box-shadow .12s ease, opacity .12s ease;
    }
    .delStuBtn:hover{ transform:translateY(-1px); box-shadow:0 10px 22px rgba(239,68,68,.35); }
    .delStuBtn:active{ transform:translateY(0); box-shadow:0 4px 12px rgba(239,68,68,.3); }
    .delStuBtn img.trashIcon{ width:16px; height:16px; filter:brightness(10); }

    /* Eski küçük pill stilleri bazı yerlerde hâlâ kullanılıyor */
    .pill{padding:10px 16px;border:0;border-radius:999px;background:#334155;color:#e5e7eb;font-weight:800;cursor:pointer;transition:.2s}
    .pill.active{background:linear-gradient(90deg,var(--accent1),var(--accent2)); box-shadow:0 0 0 3px rgba(16,185,129,.35);}
    .pill:hover{filter:brightness(1.05)}
    .delBtn{padding:8px 10px;border:0;border-radius:10px;background:linear-gradient(90deg,#fb7185,#f43f5e);color:#fff;font-weight:800;cursor:pointer}

    .list{margin-top:14px;background:var(--bg);border-radius:12px;padding:12px}
    .leftGroup{display:flex;align-items:center;gap:8px}
    .studentNameBtn{border:0;background:transparent;color:#e2e8f0;font-weight:800;cursor:pointer;text-align:left}
    .starBtn{border:0;background:transparent;font-size:20px;cursor:pointer;color:#f59e0b}
    .starBtn.off{color:#64748b}
    .sectionTitle{margin:12px 0 6px;font-weight:800;opacity:.9}
    .twoCol{display:grid;grid-template-columns: 300px 1fr; gap:14px}
    .dayBtn,.weekBtn{display:block;width:100%;text-align:left;padding:10px;border:0;border-radius:10px;background:#334155;color:#fff;cursor:pointer;margin-top:8px;min-height:44px}
    .empty{opacity:.7;padding:12px;text-align:center}
    .editBtn{padding:6px 12px;border:0;border-radius:6px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;font-weight:700;cursor:pointer}
    .smallRow{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .ghost{opacity:.6}

    #alert{max-width:1080px;margin:0 auto 8px;padding:10px 14px;border-radius:10px;background:#0b1427;color:#ffd6a5;display:none}
    #weekChartWrap{background:#0b1427;border-radius:12px;padding:12px;margin-top:10px}
    #pdfBtns{display:flex;gap:10px;flex-wrap:wrap}

    /* EXPORT (PDF görünümü) */
    #exportArea{
      width:1240px; padding:40px 48px 48px;
      background:var(--export-bg); color:#e5e7eb; font-family:Arial, Helvetica, sans-serif;
    }
    #exportArea h1{margin:0 0 6px;font-size:28px;color:var(--export-head)}
    #exportArea h2{margin:0 0 18px;font-size:18px;font-weight:700;color:#c7d2fe}
    #exportHead{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:10px}
    .exportCard{background:#0f1a31;border:1px solid #21314f;border-radius:12px;padding:14px}
    #exportTable table{width:100%;border-collapse:collapse}
    #exportTable th,#exportTable td{border:1px solid #21314f;padding:10px;text-align:center}
    #exportLegend{font-size:12px;opacity:.8;margin-top:6px}

    /* GİRİŞ EKRANI MOBİL OPTİMİZASYON */
    #loginPanel h3{font-size:22px}
    #loginPanel .tabs button{font-size:16px;padding:14px;min-height:48px}
    #loginPanel input,#loginPanel select{font-size:16px;min-height:48px}
    #loginPanel button.action{font-size:16px;min-height:52px}
    @media (max-width: 768px){
      .header{font-size:20px}
      .subheader{font-size:14px}
      #loginPanel .container{padding:18px}
      #loginPanel h3{font-size:24px}
      #loginPanel .tabs{gap:6px}
      #loginPanel .tabs button{font-size:17px;padding:14px 12px}
      #loginPanel input,#loginPanel select{font-size:17px}
      #loginPanel button.action{font-size:17px}
      .twoCol{grid-template-columns:1fr}
    }
    @media (max-width: 480px){
      .header{font-size:18px;padding:18px}
      .subheader{font-size:12px}
      #loginPanel .tabs{padding:6px}
      #loginPanel .tabs button{font-size:18px;min-width:130px;padding:12px}
      #loginPanel h3{font-size:22px;margin-bottom:10px}
      #loginPanel input,#loginPanel select{font-size:18px;padding:14px;min-height:52px}
      #loginPanel button.action{font-size:18px;padding:14px;min-height:56px}
      .container{margin:12px}
    }
    .teacherWelcome{opacity:.8;margin:0 0 10px}
    .favBlock{background:#0b1427;border-radius:12px;padding:10px;margin-top:8px}
  
    

    input:focus,
    select:focus,
    textarea:focus {
      outline: 3px solid rgba(34,197,94,.65);
      outline-offset: 2px;
      border-color: rgba(34,197,94,.65);
      box-shadow: 0 0 0 3px rgba(34,197,94,.25);
    }

    .delFloat img.trashIcon,
    .delStuFloat img.trashIcon {
      width: 24px;
      height: 24px;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,.4));
      transition: transform .15s ease, filter .15s ease;
    }
    .delFloat:hover img.trashIcon,
    .delStuFloat:hover img.trashIcon {
      transform: scale(1.15);
      filter: drop-shadow(0 0 6px rgba(220,38,38,.7));
    }

    .delFloat img.trashIcon,
    .delStuFloat img.trashIcon {
      width: 24px;
      height: 24px;
      display: block;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,.4));
      transition: transform .15s ease, filter .15s ease;
    }
    .delFloat:hover img.trashIcon,
    .delStuFloat:hover img.trashIcon {
      transform: scale(1.2);
      filter: drop-shadow(0 0 6px rgba(239,68,68,.8));
    }

    .delFloat img.trashIcon,
    .delStuFloat img.trashIcon {
      width: 24px;
      height: 24px;
      display: block;
      stroke: #ef4444;
      transition: transform .15s ease, filter .15s ease;
    }
    .delFloat:hover img.trashIcon,
    .delStuFloat:hover img.trashIcon {
      transform: scale(1.2);
      filter: drop-shadow(0 0 6px rgba(239,68,68,.8));
    }

    .delFloat img.trashIcon,
    .delStuFloat img.trashIcon {
      width: 22px;
      height: 22px;
      display: block;
      image-rendering: auto;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,.35));
      transition: transform .15s ease, filter .15s ease, opacity .15s ease;
    }
    .delFloat:hover img.trashIcon,
    .delStuFloat:hover img.trashIcon {
      transform: scale(1.12);
      filter: drop-shadow(0 0 8px rgba(239,68,68,.75));
    }

    /* ==== Giriş Türü Seçimi (Öğrenci / Veli) ==== */
    .roleGrid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap:14px;
      margin-top:8px;
    }
    .roleCard{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:22px 16px;
      border:1px solid var(--cardBorder);
      border-radius:14px;
      background:var(--card);
      cursor:pointer;
      transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease;
      text-align:center;
      color:var(--text);
    }
    .roleCard:hover{ transform:translateY(-2px); box-shadow:0 8px 18px rgba(0,0,0,.25); border-color:#3b4b6a; }
    .roleCard:focus{
      outline:3px solid rgba(16,185,129,.55);
      outline-offset:2px;
    }
    .roleIcon{
      width:68px; height:68px; display:grid; place-items:center;
      border-radius:14px;
      background:linear-gradient(135deg, rgba(59,130,246,.12), rgba(6,182,212,.12));
      color:#93c5fd;
    }
    .roleIcon svg{ width:36px; height:36px; display:block; }
    .roleCard.parent .roleIcon{ color:#34d399; background:linear-gradient(135deg, rgba(52,211,153,.12), rgba(6,182,212,.12)); }
    .roleTitle{ font-weight:900; letter-spacing:.2px; }

/* ==== Farklı Hesap ve Çıkış Butonları ==== */
.smallRow {
  display: flex;
  gap: 10px;
  justify-content: center;
}
.smallRow .pill {
  padding: 8px 16px;
  border-radius: 20px;
  font-weight: 600;
}
.smallRow .pill.account {
  background: #facc15; /* sarı */
  border: none;
  color: #111;
}
.smallRow .pill.account:hover {
  background: #eab308;
}
.smallRow .pill.exit {
  background: #ef4444; /* kırmızı */
  border: none;
  color: #fff;
}
.smallRow .pill.exit:hover {
  background: #dc2626;
}


/* ==== Mobil Optimizasyon: Giriş Türü Seçimi ==== */
@media (max-width: 768px) {
  .roleGrid { grid-template-columns: 1fr; gap: 12px; }
  .roleCard { padding: 18px 14px; }
  .roleIcon { width: 60px; height: 60px; }
  .roleIcon svg { width: 30px; height: 30px; }
  .roleTitle { font-size: 18px; }
  .smallRow { justify-content: center; }
  .smallRow .pill { width: 100%; max-width: 240px; }
}
@media (max-width: 480px) {
  .roleCard { padding: 16px 12px; }
  .roleIcon { width: 54px; height: 54px; }
  .roleIcon svg { width: 28px; height: 28px; }
  .roleTitle { font-size: 17px; }
}


    /* ========= MODERN TAKVİM (Eklendi) ========= */
    .calendarWrap{
      background:var(--card);
      border:1px solid var(--cardBorder);
      border-radius:14px;
      padding:12px;
      margin-top:12px;
    }
    .calHeader{
      display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;
    }
    .calTitle{font-weight:900;letter-spacing:.2px;text-transform:capitalize}
    .calNav{display:flex;gap:8px;}
    .calBtn{
      border:0;border-radius:10px;background:#0f1a31;color:#e2e8f0;
      padding:8px 10px;cursor:pointer;font-weight:800;
    }
    .calGrid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;}
    .calWd{opacity:.75;font-size:12px;text-align:center;margin-bottom:2px}
    .calCell{
      position:relative;min-height:42px;border:1px solid #23324a;border-radius:10px;
      display:flex;align-items:flex-start;justify-content:flex-end;padding:8px;cursor:pointer;background:#0f1a31;
      transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease;
    }
    .calCell:hover{ transform:translateY(-1px); box-shadow:0 8px 18px rgba(0,0,0,.25); border-color:#3b4b6a; }
    .calCell.muted{opacity:.5}
    .calDay{font-weight:800}
    .calDot{
      position:absolute;left:8px;bottom:8px;width:8px;height:8px;border-radius:999px;background:#ef4444;
      box-shadow:0 0 0 2px rgba(239,68,68,.15);
    }
    .calCell.today{outline:2px dashed rgba(59,130,246,.6); outline-offset:2px;}
    .calCell.selected{box-shadow:0 0 0 3px rgba(16,185,129,.45) inset;border-color:#16a34a;}
    @media (max-width:560px){
      .calCell{min-height:38px;padding:6px}
      .calTitle{font-size:14px}
    }
    /* ================================== */

    /* === Bugün butonu + mobil düzenlemeleri === */
    .calHeader{ position:sticky; top:0; z-index:5; background:linear-gradient(180deg, rgba(11,20,39,.95), rgba(11,20,39,.88)); backdrop-filter:saturate(1.2) blur(4px); border-radius:12px 12px 0 0; padding:8px; }
    .calBtnToday{
      border:0;border-radius:10px;background:#14532d;color:#e2e8f0;
      padding:8px 12px;cursor:pointer;font-weight:900;
    }
    .calBtn:disabled,.calBtnToday:disabled{opacity:.5;cursor:default}
    .calendarWrap{ position:relative; }
    /* Floating "Bugün" on mobile */
    .calFab{
      position:sticky; bottom:8px; left:100%; transform:translateX(-100%);
      margin-top:8px; display:none;
    }
    .calFab button{
      border:0; border-radius:999px; padding:10px 14px; font-weight:900; background:#14532d; color:#fff;
      box-shadow:0 6px 14px rgba(0,0,0,.35);
    }
    /* Touch-friendly cells */
    .calCell{ min-height:48px; }
    @media (max-width:600px){
      .calGrid{ gap:4px; }
      .calWd{ font-size:11px; }
      .calCell{ min-height:44px; padding:6px; }
      .calTitle{ font-size:15px; }
      .calNav .calBtn{ padding:8px 10px; }
      .calFab{ display:block; }
    }


  
  /* ==== Liste Görünümü V5.4: Soru Sayısı & Hedef Bölgesi Renkli ==== */
  .student-toolbar{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin:12px 0 6px; }
  .densityToggle{
    background: var(--card); color: var(--text); border: 1px solid var(--cardBorder);
    border-radius: 10px; padding: 8px 12px; cursor:pointer;
  }
  .chip{
    display:inline-flex; align-items:center; gap:6px;
    border-radius:999px; padding:6px 10px; font-weight:800; font-size:12px;
    background:var(--card); border:1px solid var(--cardBorder);
  }
  .chip .dot{ width:10px; height:10px; border-radius:999px; }
  .chip.turkce .dot{ background:#fb923c; }
  .chip.sosyal .dot{ background:#6366f1; }
  .chip.din .dot{ background:#22c55e; }
  .chip.ing .dot{ background:#0ea5e9; }
  .chip.mat .dot{ background:#f43f5e; }
  .chip.fen .dot{ background:#14b8a6; }

  .lessonList.dense{ display:flex; flex-direction:column; gap:8px; margin:10px 0; }
  
  .lessonRow.dense {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    background: var(--card);
    border: 1px solid var(--cardBorder);
    border-radius: 12px;
    padding: 12px;
    transition: border-color .15s ease, box-shadow .15s ease;
  }
  .lessonRow.dense > .chip {
    justify-self: start; /* Align chip to the left */
  }
  .lessonRow.dense:hover { border-color:#3b4b6a; box-shadow:0 8px 18px rgba(0,0,0,.22); }


  .lessonControls {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    align-items: center;
    width: 100%;
  }
  .lessonControls input[type=number]{
    width:100px; min-height:34px; font-size:14px;
    background:var(--bg); color:var(--text); border:0; border-radius:10px; padding:8px 10px;
  }
  .lessonControls input[type=number]::-webkit-outer-spin-button,
  .lessonControls input[type=number]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0; }
  .lessonControls input[type=number]{ -moz-appearance:textfield; }
  .numBtn{
    width:34px; height:34px; display:grid; place-items:center; border:0; border-radius:10px;
    background:#334155; color:#fff; font-weight:900; font-size:15px; cursor:pointer;
    transition: transform .08s ease, filter .12s ease;
  }
  .numBtn:hover{ filter:brightness(1.06); }
  .numBtn:active{ transform: translateY(1px); }

  /* === Renkli bölgeler === */
  /* Soru sayısı bölgesi: indigo ton */
  .countWrap{
    display:inline-flex; align-items:center; gap:6px;
    padding:4px 6px; border-radius:999px;
    background: rgba(99,102,241,.10);           /* indigo-500 @10% */
    border:1px solid rgba(99,102,241,.35);
    box-shadow: inset 0 0 0 1px rgba(99,102,241,.12);
    width: 100%;
    justify-content: space-between;
  }
  .countWrap:focus-within{ box-shadow: 0 0 0 3px rgba(99,102,241,.25); }
  .countWrap .numBtn{ background:#4f46e5; }     /* indigo-600 */
  .countWrap input[type=number]{ background:transparent; }

  /* Hedef bölgesi: sky ton */
  .goalWrap{
    display:inline-flex; align-items:center; gap:6px;
    padding:4px 6px; border-radius:999px;
    background: rgba(14,165,233,.10);           /* sky-500 @10% */
    border:1px solid rgba(14,165,233,.35);
    box-shadow: inset 0 0 0 1px rgba(14,165,233,.12);
    width: 100%;
    justify-content: space-between;
  }
  .goalWrap:focus-within{ box-shadow: 0 0 0 3px rgba(14,165,233,.25); }
  .goalIcon{ font-size:16px; line-height:1; width:18px; height:18px; display:grid; place-items:center;
  cursor: pointer;}
  .goalInput{
    width:64px; min-height:30px; font-size:14px; border:0; outline:none;
    background:transparent; color:var(--text); text-align:center;
  }

  .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

  /* Footer: progress + % badge sağda */
  .rowFooter{ display:flex; align-items:center; gap:12px; width:100%; }
  .progressWrap{ position:relative; flex:1 1 auto; min-width:0; height:6px; background:var(--cardBorder);
    border-radius:999px; overflow:hidden; }
  .progressBar{ position:absolute; top:0; left:0; height:100%; width:0%;
    background:linear-gradient(90deg,#22c55e,#0ea5e9); transition: width .15s ease; }
  .pctBadge{
    min-width: 50px;
    height: 26px;
    display:grid; place-items:center;
    padding:0 12px;
    border-radius:999px; font-weight:900;
    font-size:13px;
    background:#0b9444; color:#fff; margin-left:auto;
    flex-shrink: 0; /* Prevent shrinking */
  }
  .pctBadge.low{ background:#eab308; }
  .pctBadge.zero{ background:#6b7280; }

  .totalBar{ display:flex; align-items:center; justify-content:flex-end; gap:8px; margin-top:8px; font-weight:800; }
  .totalBadge{ min-width:56px; text-align:center; background:#0ea5e9; color:white; border-radius:10px; padding:8px 10px; }

  @media (max-width: 560px){
    .lessonControls{ 
      grid-template-columns: 1fr; /* Stack counter and target on mobile */
    }
    .countWrap input[type=number] {
      width: 60px;
    }
    .goalWrap .goalInput {
      width: 50px;
    }
  }


    /* === Öğretmen Üst Çubuğu ve Küçük Çıkış Düğmesi === */
    .teacherTopbar{display:flex;align-items:center;justify-content:space-between;gap:8px;margin:6px 0 8px;}
    button.exitSmall{border:0;border-radius:10px;padding:6px 10px;min-height:32px;background:#ef4444;color:#fff;font-weight:800;cursor:pointer}
    button.exitSmall:hover{background:#dc2626}
    button.exitSmall:focus{outline:3px solid rgba(16,185,129,.55);outline-offset:2px;}

/* === Update: Larger Exit Button + Icon === */
button.exitSmall{padding:8px 12px;min-height:38px;font-size:14px;display:inline-flex;align-items:center;gap:8px}
button.exitSmall .icon{width:16px;height:16px;line-height:0;display:inline-flex}
button.exitSmall .icon svg{display:block}
button.exitSmall .label{line-height:1}

/* ====== Günlük Rapor Tasarımı (Calendar + Table) — 2025-10-03 ====== */
/* Kapsamı yalnızca Günlük sekmesine uygula */
#repTab-daily .calendarWrap{
  background: linear-gradient(180deg, rgba(11,18,32,.92), rgba(11,18,32,.92));
  border: 1px solid var(--cardBorder, #1e293b);
  border-radius: 16px;
  box-shadow: 0 20px 50px rgba(0,0,0,.45);
  padding: 16px;
}

/* Başlık çubuğu */
#repTab-daily .calHeader{
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom: 12px;
}
#repTab-daily .calTitle{ font-weight:800; letter-spacing:.2px; }
#repTab-daily .calNav .calBtn{
  border:1px solid rgba(148,163,184,.25);
  background: rgba(148,163,184,.06);
  border-radius:10px; padding:6px 8px; min-height:32px;
  cursor:pointer; transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease;
}
#repTab-daily .calNav .calBtn:hover{ transform: translateY(-1px); box-shadow:0 8px 18px rgba(0,0,0,.25); }
#repTab-daily .calBtnToday{
  background: linear-gradient(180deg, #22c55e, #16a34a);
  color:#fff; font-weight:900; border:0;
  border-radius:12px; padding:6px 12px; min-height:32px;
}

/* Takvim ızgarası */
#repTab-daily .calGrid{ gap: 10px; }
#repTab-daily .calWd{ opacity:.9; font-weight:700; }
#repTab-daily .calCell{
  position:relative;
  min-height:56px;
  border:1px solid #23324a;
  border-radius:14px;
  background:#0f1a31;
  display:flex; align-items:flex-start; justify-content:flex-end;
  padding:10px;
  transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease;
}
#repTab-daily .calCell:hover{ transform:translateY(-1px); box-shadow:0 8px 18px rgba(0,0,0,.25); border-color:#3b4b6a; }
#repTab-daily .calCell.today{ outline:2px dashed rgba(59,130,246,.6); outline-offset:2px; }
#repTab-daily .calCell.selected{
  outline: 2px dashed rgba(16,185,129,.55);
  outline-offset: -4px;
  box-shadow: 0 0 0 3px rgba(16,185,129,.25) inset;
  border-color:#16a34a;
}
#repTab-daily .calDay{ font-weight:800; opacity:.95; }
#repTab-daily .calDot{
  position:absolute; left:10px; top:10px;
  width:7px; height:7px; border-radius:9999px; background:#ef4444; box-shadow:0 0 0 2px rgba(239,68,68,.15);
}

/* Seçilen gün tablosu kartı */
#repTab-daily #selDayBlock{
  margin-top:14px;
  background: linear-gradient(180deg, rgba(11,18,32,.92), rgba(11,18,32,.92));
  border:1px solid var(--cardBorder,#1e293b);
  border-radius:14px;
  box-shadow: 0 20px 50px rgba(0,0,0,.45);
  padding: 16px;
}
#repTab-daily #selDayBlock .sectionTitle{
  font-weight:800; margin-bottom:10px;
}

/* Tablo görünümü */
#repTab-daily #stuDayTable, #repTab-daily #tsdDayTable table{ width:100%; border-collapse:separate; border-spacing:0; }
#repTab-daily #stuDayTable, #repTab-daily #tsdDayTable th,
#repTab-daily #stuDayTable, #repTab-daily #tsdDayTable td{
  padding:12px 14px;
  border-bottom:1px solid #23324a;
}
#repTab-daily #stuDayTable, #repTab-daily #tsdDayTable thead th{
  text-align:left; font-weight:700; background:#0d1628;
}
#repTab-daily #stuDayTable, #repTab-daily #tsdDayTable tr:last-child td{ border-bottom:0; }

/* Düzenle düğmesi */
#repTab-daily #stuDayTable, #repTab-daily #tsdDayTable .editBtn{
  border:0; border-radius:10px; padding:6px 12px; min-height:32px;
  background: linear-gradient(180deg, #3b82f6, #06b6d4);
  color:#fff; font-weight:800; cursor:pointer;
  transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
}
#repTab-daily #stuDayTable, #repTab-daily #tsdDayTable .editBtn:hover{ transform:translateY(-1px); box-shadow:0 10px 22px rgba(0,0,0,.25); filter:saturate(1.05); }
#repTab-daily #stuDayTable, #repTab-daily #tsdDayTable .editBtn:focus{ outline:3px solid rgba(16,185,129,.45); outline-offset:2px; }

/* Küçük ekran ayarı */
@media (max-width: 560px){
  #repTab-daily .calGrid{ gap:8px; }
  #repTab-daily .calCell{ min-height:44px; padding:8px; }
  #repTab-daily #selDayBlock{ padding:12px; }
  #repTab-daily #stuDayTable, #repTab-daily #tsdDayTable th, #repTab-daily #stuDayTable, #repTab-daily #tsdDayTable td{ padding:10px 12px; }
}
/* ====== /Günlük Rapor Tasarımı ====== */


/* === Haftalık Sekme: Açılır Hafta Listesi (Dropdown) === */
#repTab-weekly #weekControls{ display:flex; align-items:center; gap:12px; }
#repTab-weekly .weekDropdown{ position:relative; display:inline-block; }
#repTab-weekly .wdToggle{
  border:0; border-radius:12px; padding:8px 12px; min-height:36px;
  background: linear-gradient(180deg, #3b82f6, #06b6d4);
  color:#fff; font-weight:900; cursor:pointer;
  display:flex; align-items:center; gap:10px;
}
#repTab-weekly .wdToggle .chev{ font-weight:900; opacity:.9; }
#repTab-weekly .wdMenu{
  position:absolute; top:calc(100% + 6px); left:0; z-index:50;
  background:#0f1a31; border:1px solid #23324a; border-radius:12px; padding:8px;
  box-shadow:0 20px 50px rgba(0,0,0,.45); min-width:320px; max-height:280px; overflow:auto;
  display:none;
}
#repTab-weekly .wdMenu.open{ display:block; }
#repTab-weekly .wdItem{
  display:block; width:100%; text-align:left; border:0; background:transparent; color:inherit;
  padding:8px 10px; border-radius:8px; cursor:pointer;
}
#repTab-weekly .wdItem:hover{ background:rgba(148,163,184,.08); }
#repTab-weekly .wdItem.active{ background:rgba(34,197,94,.15); outline:1px dashed rgba(16,185,129,.45); }
@media (max-width:560px){
  #repTab-weekly .wdMenu{ min-width:260px; }
}
/* === /Dropdown CSS === */

    /* === Öğrenci Hoşgeldin Bannerı === */
    .studentWelcomeBanner{
      margin:10px 0 12px;
      padding:12px 14px;
      border-radius:12px;
      background: linear-gradient(180deg, rgba(34,197,94,.16), rgba(6,182,212,.10));
      border:1px solid rgba(34,197,94,.35);
      font-weight:800;
      color:#d1fae5;
      text-align:center;
      box-shadow: 0 10px 26px rgba(0,0,0,.25), inset 0 0 0 1px rgba(34,197,94,.15);
    }

/* === Hedef (daily target) === */
.targetBtn{
  border:none;background:transparent;cursor:pointer;font-size:20px;line-height:1;
  filter: drop-shadow(0 1px 1px rgba(0,0,0,.4));
}
.targetBtn:hover{ transform: scale(1.05); }
.targetInfo{
  margin:6px 0 10px; padding:8px 10px; border-radius:10px;
  background: rgba(16,185,129,.08); border:1px solid rgba(16,185,129,.25);
  font-weight:600; display:flex; gap:8px; align-items:center; justify-content:space-between;
}
.targetInfo small{opacity:.9}


/* Float target button next to trash */
.targetFloat{
  position:absolute; top:8px; right:52px; /* 8px (gap) + 36px (trash width) => sit left of trash */
  display:grid; place-items:center;
  width:36px; height:36px; padding:0;
  border:0; border-radius:999px;
  background:transparent;
  cursor:pointer;
  transition:transform .12s ease, opacity .12s ease;
  z-index:2;
}
.targetFloat:hover{ transform:translateY(-1px); }

</style>
<style>
/* --- Açılır Pencere (Rapor Modal) --- */
#reportOverlay{position:fixed;inset:0;display:none;background:rgba(0,0,0,.45);z-index:9998;}
#teacherStudentDetail.asModal{position:fixed;inset:auto auto 5% 50%;transform:translateX(-50%);width:min(920px,92vw);max-height:88vh;overflow:auto;
  background:var(--card,#0b1427);border:1px solid var(--cardBorder,#1e293b);border-radius:14px;box-shadow:0 20px 50px rgba(0,0,0,.45);padding:16px;z-index:9999;}
.modalHead{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-bottom:8px;position:sticky;top:0;background:inherit;padding-bottom:8px;}
.modalTabs{display:flex;gap:8px;align-items:center;}
.modalTabs .pill{cursor:pointer;}
.modalClose{margin-left:auto}
#repTab-daily,#repTab-weekly,#repTab-monthly{display:none;}
#repTab-daily.active,#repTab-weekly.active,#repTab-monthly.active{display:block;}
@media (max-width:720px){
  #teacherStudentDetail.asModal{inset:auto auto 2% 50%; width:96vw; }
}
</style>

<style>
@media (max-width: 600px){
  /* Goals başlığını header altına taşıdığımızda gp-header içindekini gizle */
  #goalsPage .gp-title{ display: none !important; }

  /* Header altında yeni başlık görünümü */
  .header .header-goals-title{
    display: block;
    margin-top: 6px;
    font-weight: 800;
    font-size: clamp(18px, 5vw, 22px);
    line-height: 1.15;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
}
</style>
<script>
(function(){
  function ensureGoalsTitle(){
    try{
      var header = document.querySelector('.header');
      var sub = header && header.querySelector('.subtitle');
      var srcTitle = document.querySelector('#goalsPage .gp-title');
      if(!header || !sub || !srcTitle) return;

      var txt = srcTitle.textContent.trim();
      var el = header.querySelector('.header-goals-title');
      if(!el){
        el = document.createElement('div');
        el.className = 'header-goals-title';
        sub.insertAdjacentElement('afterend', el);
      }
      if(el.textContent.trim() !== txt){ el.textContent = txt; }

      // Görünürlüğü sadece goals sayfası görünürken aç
      var gp = document.getElementById('goalsPage');
      var isVisible = gp && gp.offsetParent !== null && window.getComputedStyle(gp).display !== 'none';
      el.style.display = (isVisible ? '' : 'none');
    }catch(e){}
  }

  document.addEventListener('DOMContentLoaded', function(){
    setTimeout(ensureGoalsTitle, 50);
  });

  var mo = new MutationObserver(function(){ setTimeout(ensureGoalsTitle, 50); });
  mo.observe(document.documentElement, {subtree:true, attributes:true, childList:true, attributeFilter:['style','class']});

  window.addEventListener('resize', function(){ setTimeout(ensureGoalsTitle, 100); }, {passive:true});
  window.addEventListener('orientationchange', function(){ setTimeout(ensureGoalsTitle, 200); }, {passive:true});
})();
</script>
<style>
/* Hide the Monthly tab button and its content in the teacher modal */
#teacherStudentDetail #repTabMonthlyBtn,
#teacherStudentDetail #repTab-monthly{ display:none !important; }
</style>
<script>
(function(){
  // Force default to weekly when opening the teacher report modal
  if (typeof openReportModal === 'function'){
    const __origOpen = openReportModal;
    window.openReportModal = function(){
      var ov = document.getElementById('reportOverlay');
      var box = document.getElementById('teacherStudentDetail');
      if(ov) ov.style.display='block';
      if(box){ box.style.display='block'; }
      try{ showReportTab('weekly'); }catch(_){}
    };
  }

  // Remove Monthly tab elements entirely (defensive)
  document.addEventListener('DOMContentLoaded', function(){
    try{
      var btn = document.getElementById('repTabMonthlyBtn'); if(btn) btn.remove();
      var pane = document.getElementById('repTab-monthly'); if(pane) pane.remove();
    }catch(e){}
  });
})();
</script>
<style>
/* Goals başlığını her boyutta header altına taşı: gp-header içindeki başlık gizlenir */
#goalsPage .gp-title{ display: none !important; }
/* Header altına eklenecek başlığın görünümü */
.header .header-goals-title{
  display: block;
  margin-top: 6px;
  font-weight: 800;
  font-size: clamp(18px, 2.2vw, 24px);
  line-height: 1.15;
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
</style>
<script>
(function(){
  function ensureGoalsTitle(){
    try{
      var header = document.querySelector('.header');
      var sub = header && header.querySelector('.subtitle');
      var srcTitle = document.querySelector('#goalsPage .gp-title');
      if(!header || !sub || !srcTitle) return;

      var txt = (srcTitle.textContent || '').trim();
      var el = header.querySelector('.header-goals-title');
      if(!el){
        el = document.createElement('div');
        el.className = 'header-goals-title';
        sub.insertAdjacentElement('afterend', el);
      }
      if((el.textContent || '').trim() !== txt){ el.textContent = txt; }

      // Sadece Goals sayfası görünürken göster
      var gp = document.getElementById('goalsPage');
      var gpVisible = gp && window.getComputedStyle(gp).display !== 'none';
      el.style.display = gpVisible ? '' : 'none';
    }catch(e){/* no-op */}
  }

  document.addEventListener('DOMContentLoaded', function(){ setTimeout(ensureGoalsTitle, 50); });
  var mo = new MutationObserver(function(){ setTimeout(ensureGoalsTitle, 50); });
  mo.observe(document.documentElement, {subtree:true, childList:true, attributes:true, attributeFilter:['style','class']});
  window.addEventListener('resize', function(){ setTimeout(ensureGoalsTitle, 100); }, {passive:true});
  window.addEventListener('orientationchange', function(){ setTimeout(ensureGoalsTitle, 200); }, {passive:true});
})();
</script>
<style>
/* Öğretmen paneli > Favoriler bölümündeki 'Göster' butonlarını kaldır */
#favoritesSection .editBtn{ display: none !important; }
</style>
</head>
<style>
/* ===== Ders Hedefleri (Goals Page) — Modern görünüm ===== */
#goalsPage{
  padding: 8px 12px 20px;
}
#goalsPage .gp-header{
  position: sticky; top: 0; z-index: 30;
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:10px 0;
  background: linear-gradient(180deg, rgba(11,20,39,.92), rgba(11,20,39,.86));
  border-bottom: 1px solid var(--cardBorder);
  backdrop-filter: saturate(1.1) blur(6px);
}
#goalsPage .gp-left{ display:flex; align-items:center; gap:10px; }
#goalsPage .gp-title{ font-weight:900; letter-spacing:.2px; display:flex; align-items:center; gap:8px; }
#goalsPage .gp-actions{ display:flex; align-items:center; gap:8px; }

/* Buton ikon düzeni — mevcut .pill ve .action renklerini kullan */
.gp-btn{ display:inline-flex; align-items:center; gap:8px; }
.gp-btn .icon{ width:16px; height:16px; line-height:0; display:inline-flex; }
.gp-btn .icon svg{ width:16px; height:16px; display:block; }

/* “Tablo” kutusu — satır ızgarası */
.gp-table{
  max-width: 760px; margin: 0 auto;
  background: var(--card);
  border: 1px solid var(--cardBorder);
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 16px 40px rgba(0,0,0,.35);
}
.gp-row{
  display: grid; grid-template-columns: 1fr 140px;
  align-items: center; gap: 12px;
  padding: 12px 14px;
  border-top: 1px solid var(--cardBorder);
}
.gp-row:first-child{ border-top:0; }
.gp-row:nth-child(odd){ background: rgba(148,163,184,.05); }

.gp-label{
  display:flex; align-items:center; gap:10px; font-weight:800;
}
.gp-label .dot{ width:10px; height:10px; border-radius:999px; }
.gp-label.turkce   .dot{ background:#fb923c; }
.gp-label.sosyal   .dot{ background:#6366f1; }
.gp-label.din      .dot{ background:#22c55e; }
.gp-label.ing      .dot{ background:#0ea5e9; }
.gp-label.matematik .dot{ background:#f43f5e; }
.gp-label.fen      .dot{ background:#14b8a6; }

.gp-input{
  width:100%;
  min-height:42px; font-size:16px; text-align:center; font-weight:700;
  background: var(--bg);
  color: var(--text);
  border: 1px solid var(--cardBorder);
  border-radius: 12px;
  padding: 10px 12px;
}
.gp-input::-webkit-outer-spin-button,
.gp-input::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0; }
.gp-input{ -moz-appearance: textfield; }

#goalsPage .gp-note{
  max-width:760px; margin:8px auto 0; opacity:.8;
}

/* Mobil ayar */
@media (max-width: 560px){
  .gp-row{ grid-template-columns: 1fr 110px; padding: 10px 12px; }
  .gp-input{ min-height:38px; font-size:15px; }
}
</style>
<style>
/* === Goals Page header buttons: same size + custom colors === */
#goalsPage .gp-header .gp-btn{
  min-height: 40px;
  min-width: 120px;
  padding: 8px 14px;
  border-radius: 12px;
  font-weight: 900;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}
#goalsPage .gp-header .gp-btn .icon{ width:16px; height:16px; }

/* Back = red */
#goalsPage .gp-header .gp-back{
  background: linear-gradient(180deg,#ef4444,#dc2626) !important;
  color:#fff !important;
  border:1px solid #7f1d1d;
  box-shadow:0 6px 16px rgba(239,68,68,.25), inset 0 1px 0 rgba(255,255,255,.08);
}

/* Clear = green */
#goalsPage .gp-header .gp-clear{
  background: linear-gradient(180deg,#10b981,#059669) !important;
  color:#fff !important;
  border:1px solid #065f46;
  box-shadow:0 6px 16px rgba(16,185,129,.25), inset 0 1px 0 rgba(255,255,255,.08);
}
</style>
<style>
/* Center goals page title */
#goalsPage .gp-header{ position: relative; }
#goalsPage .gp-header .gp-title{
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  font-weight: 800;
}
</style><style>
/* Override: goals title left-aligned and larger */
#goalsPage .gp-header .gp-title{
  position: static !important;
  left: auto !important;
  transform: none !important;
  text-align: left !important;
  font-size: 1.5rem !important; /* biraz büyütüldü */
  line-height: 1.3 !important;
}
</style>
<style>
/* Hide only in parent mode */
body[data-role="parent"] #studentTab-entry #lessonForm { display:none !important; }
body[data-role="parent"] #studentTab-entry .totalBar { display:none !important; }
body[data-role="parent"] #studentTab-entry .addBtn { display:none !important; }
/* Optional: keep layout tidy when form is hidden */
body[data-role="parent"] #studentTab-entry .student-toolbar { margin-bottom: 8px; }
</style>
<script>
(function(){
  // Track active role
  window.activeRole = window.activeRole || 'student';

  function setBodyRoleAttr(){
    try{ document.body.setAttribute('data-role', (window.activeRole==='parent'?'parent':'student')); }catch(_){}
  }

  // UI sync across roles
  window.applyRoleUi = (function(prev){
    return function(){
      try{
        var isParent = (window.activeRole === 'parent');
        // Titles
        var title = document.getElementById('studentPanelTitle');
        var barTitle = document.getElementById('studentPanelToolbarTitle');
        if(title) title.textContent = isParent ? 'Veli Paneli' : 'Öğrenci Paneli';
        if(barTitle) barTitle.textContent = isParent ? 'Veli Paneli' : 'Öğrenci Paneli';
        // Tab name: Soru Girişi -> Günlük Rapor (parent only)
        var entryBtn = document.getElementById('stuTabEntryBtn');
        if(entryBtn){
          entryBtn.textContent = isParent ? 'Günlük Rapor' : 'Soru Girişi';
        }
        // Ensure correct data-role on body
        setBodyRoleAttr();
      }catch(_){}
      // Call any previous implementation if existed
      try{ if(typeof prev === 'function') prev(); }catch(_){}
    };
  })(window.applyRoleUi);

  // Give IDs to existing titles if they aren't present
  try{
    var h3 = document.querySelector('#studentPanel h3');
    if(h3 && !h3.id && h3.textContent.trim().toUpperCase().includes('ÖĞRENCİ')){ h3.id = 'studentPanelTitle'; }
    var strong = document.querySelector('#studentTab-entry .student-toolbar strong');
    if(strong && !strong.id && strong.textContent.trim().toUpperCase().includes('ÖĞRENCİ')){ strong.id = 'studentPanelToolbarTitle'; }
  }catch(_){}

  // Wrap enterAsStudent to set role + update UI
  if (typeof window.enterAsStudent === 'function'){
    var __orig_enterAsStudent = window.enterAsStudent;
    window.enterAsStudent = function(){
      window.activeRole = 'student';
      __orig_enterAsStudent();
      window.applyRoleUi();
    };
  }

  // Parent entry mirrors student panel; keeps daily calendar & table
  window.enterAsParent = function(){
    window.activeRole = 'parent';
    var rc = document.getElementById('roleChoice'); if(rc) rc.style.display='none';
    var lp = document.getElementById('loginPanel'); if(lp) lp.style.display='none';
    var sp = document.getElementById('studentPanel'); if(sp) sp.style.display='block';
    // make sure "entry" tab is active
    try{ window.showStudentTab('entry'); }catch(_){}
    // load data so calendar + daily table render in #studentRecords
    try{ window.loadStudentData(); }catch(_){}
    window.applyRoleUi();
  };

  // Ensure logout resets role back to student
  if (typeof window.logout === 'function'){
    var __orig_logout = window.logout;
    window.logout = function(){
      __orig_logout();
      window.activeRole = 'student';
      window.applyRoleUi();
    };
  }

  // Initialize
  setBodyRoleAttr();
  window.applyRoleUi();
})();
</script>
</body>
</html>
